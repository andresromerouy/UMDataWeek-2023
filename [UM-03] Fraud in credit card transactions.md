# [UM-03] Fraud in credit card transactions

## Introduction

**Payment card fraud** is a major challenge for business, causing every year substantial financial loss. According to the 2019 Nilson Report, card fraud losses worldwide increased from 9.84 billion dollars in 2011 to 27.85 billion dollars in 2018, and are forecasted to reach more than 40 billion dollars in 2027. Nevertheless, card fraud in Europe declined notably in 2021 amid the implementation of regulatory measures, according to the last report form the European Central Bank.

Detecting **fraud patterns** in payment card transactions is known to be a very difficult problem. With the ever-growing amount of data generated by payment card transactions, it has become impossible for a human analyst to detect fraudulent patterns in **transaction datasets**, often characterized by a large number of samples, many dimensions, and online updates. Fraud detection is a cat and mouse game, where fraudulent patterns change over time. As technology evolves, both in terms of fraud prevention and ease of use of payment systems, so do fraudster techniques. They adapt by moving from the old targets to the vulnerability of the new technologies. They also benefit from the constant changes in volume and characteristics of genuine transactions. As a result, the design of payment card fraud detection techniques has increasingly focused in the last decade on approaches based on **machine learning** (ML) techniques, that automate the process of identifying fraudulent patterns from large volumes of data.

Integratingf ML techniques in payment card fraud detection systems has greatly improved their ability to efficiently detect fraud, and **identify illicit transactions**. Though in recent years the number of fraudulent transactions kept on increasing, the percentage of losses due to fraud started to decrease in 2016, a reverse trend that is associated with the increasing adoption of ML solutions. On top of helping saving money, implementing ML-based fraud detection systems is today a must-do for companies to gain the customers' trust.

Effective fraud detection requires a mix of automated systems and fraud investigators. This has non-trivial implications. First, **automated systems** should optimize the workload of **fraud investigators**. Second, automated systems and investigators work at different time scales: while automated systems provide risk scores for transactions in less than a second, fraud investigations require contacting a client to confirm a fraud, which can take days, or weeks. This has methodological implications.

It is useful to distinguish two transaction scenarios:

* In **card-present** (CP) scenarios, such as transactions at a **point-of-sale** (POS) or at an **automated teller machine** (ATM), a physical card is needed. In this setting, the fraud typòliogies are: (a) lost or stolen cards, (b) counterfeited cards, and (c) card not received (intercepted by a fraudster in the mailbox of a legitimate customer).

* In **card-not-present** (CNP) scenarios, the payment is performed on the Internet, by phone, or by mail, so a physical card is not required. Most CNP frauds come from illegally obtained payment credentials (*e.g*. card numbers), either from data breaches or directly from the cardholders (*e.g*. via phishing). Such credentials are usually not used directly, but rather put on sale on underground web marketplaces and later used by criminal groups. Criminals who steal data are usually not the same as those who perpetrate frauds. The data involved in CNP fraud are usually the card number, card expiration date, card security code, and personal billing information.

Fraudsters are recently more likely to exploit the deficiencies of CNP scenarios than CP ones, probably because CP scenarios have existed for more than two decades now, and have become pretty robust to fraud attacks, thanks to the EMV (Europay Mastercard and Visa) technology of chip-embedded cards. Also, physical barriers can often help to prevent CP frauds. As stated in the 2019 Nilson report, CNP scenarios accounted for 54% of all losses to fraud for the year 2018, while only accounting for less than 15% of all purchase volume worldwide (CNP+POS+ATM). The proportion of CNP fraud is even higher in Europe and was reported to account for 79% of all transactions from cards issued within SEPA in the 2020 report on card fraud of the European Central Bank.

A credit card fraud detection system is typically composed of five layers of control:

1. **Terminal**. Security checks include controlling the PIN code, the number of attempts, the card status (either active or blocked), the balance available, and the expenditure limit. These operations are performed in real-time by querying a server of the card-issuing company. Requests that do not pass any of these controls are denied, while the others become transaction requests that are processed by the second layer of control.

2. **Transaction-blocking rules** are if-then-else statements meant to block transaction requests perceived as frauds. These rules use the information available when the payment is requested, without analyzing historical records or cardholder profiles. An example of a blocking rule could be *IF internet transactions AND unsecured website THEN deny the transaction*. In practice, several blocking rules are simultaneously applied, and transactions firing any of these rules are blocked (though cards are not deactivated). Transaction-blocking rules are **expert-driven**, manually designed by investigators. To guarantee real-time operations and avoid blocking many genuine transactions, they should be quick to compute and very precise, raising very few false alarms. Transactions passing blocking rules are authorized, though the fraud detection activity continues after having enriched transaction data with aggregated features used to contextualize the current purchase with respect to the previous ones and the cardholder profile. These aggregated features include, for instance, the average expenditure, the average number of transactions in the same day, or the location of the previous purchases. This is called **feature engineering**. Aggregated features and current transaction data are stacked in a feature vector that is supposed to be informative for determining whether the authorized transaction is fraudulent or genuine. The next layers of the system operate on this feature vector.

3. **Scoring rules** are also expert-driven. They are expressed as if-then-else statements, which assign a score to each authorized transaction. Scoring rules are manually designed by investigators, who arbitrarily define their associated scores. An example of a scoring rule can be *IF previous transaction in a different continent AND less than one hour from the previous transaction THEN fraud score = 0.95*. Unfortunately, scoring rules can detect only previously discovered fraudulent strategies, with patterns involving a few features. Moreover, they are rather subjective, and they can be incomplete and difficult to maintain over time.

4. A **data-driven model** based on a classifier which estimates the **probability** for each transaction to be a fraud. This probability is used as the **fraud score** associated with the authorized transaction. The data-driven model is trained from a set of labeled transactions and cannot be interpreted or manually modified by investigators. An effective data-driven model is expected to detect fraud patterns from multiple features, according to rules that may go beyond investigator experience, and that do not necessarily correspond to interpretable rules.

5. **Investigators** are experienced in analyzing credit card transactions. They are responsible for the expert-driven layers of the detection system. In particular, they design transaction-blocking and scoring rules. Investigators are also in charge of controlling alerts raised by the scoring rules and the data-driven model, to determine whether these correspond to frauds or false alarms. They call cardholders and, after having verified, assign the label "genuine" or "fraudulent" to the alerted transaction. Any suspected card is immediately blocked. Typically, investigators check all the recent transactions from a compromised card, which means that each detected fraud can potentially generate more than one feedback. In a real-world fraud detection system, investigators can only check few alerts per day, as this process can be long and tedious. Therefore, the primary goal of a data-driven model is to return precise alerts, as investigators might ignore further alerts when too many false alarms are reported. In recent systems, transactions associated with very high-risk scores can bypass investigators and be directly sent to the cardholder for feedback requests (*e.g*. by SMS). This addition is interesting for an accelerated processing and a larger feedback bandwidth. However, it should be done with caution to avoid jeopardizing the customer's trust.

The effective application of ML methods to card fraud data present some specific challenges:

* **Class imbalance**. Transaction data contain much more legitimate than fraudulent transactions. The percentage of fraudulent transactions in real-world data is typically under 1%. Learning from imbalanced data is a difficult task since most learning algorithms do not handle well large differences between classes. Dealing with class imbalance requires the use of additional learning strategies like sampling or loss weighting, a topic known as **imbalanced learning**.

* **Concept drift**. Transaction and fraud patterns change over time. First, the spending habits of credit card users are different during weekdays, weekends, vacation periods, and evolve over time. Also, fraudsters adopt new techniques as the old ones become obsolete. This requires learning strategies that can cope with temporal changes in statistical distributions, a topic known as **online learning**. The concept drift problem is accentuated in practice by the delayed feedbacks.

* **Near real-time requirements**. Fraud detection systems must be able to quickly detect fraudulent transactions. Given the potentially high volume of transaction data, classification times in the millisecond scale may be required. This relates to the parallelization and scalability of fraud detection systems.

* **Sequential modeling**. Each terminal and/or customer generates a stream of sequential data with unique characteristics. An important challenge of fraud detection consists in modeling these streams to detect abnormal behaviors. Modeling may be done by aggregating features over time (for example, keeping track of the mean frequency or transaction amounts of a customer), or by relying on sequential prediction models (such as recurrent neural networks).

* **Class overlap**. With only raw information about a transaction, distinguishing between a fraudulent or a genuine transaction is close to impossible. This is commonly addressed using feature engineering techniques, that add contextual information to raw payment information.

* **Performance measures**. Standard measures for classification models, such as the mean misclassification error or the AUC ROC, are not well suited for detection problems, due to class imbalance and the complex cost structure of fraud detection. It is often necessary to consider multiple measures to assess the overall performance of a fraud detection system. Despite its central role in the design of a fraud detection system, there is currently no consensus on the set of performance measures to be used.

* **Lack of public datasets**. For confidentiality reasons, real-world credit card transactions cannot be publicly shared. There exist a few publicly shared data sets, with limitations such as **obfuscated features** and short time scope. The scarcity of data sets for fraud detection is also true with **simulated data**.

## The data set

In credit card fraud detection, data typically consist of transaction data, collected for example by a payment processor or a bank. Transaction data can be divided into three groups:

* **Account-related features**: account number, date of account opening, card limit, expiry date, etc.

* **Transaction-related features**: transaction reference number, account number, transaction amount, terminal number, transaction time, etc. 

* **Customer-related features**: customer number, type of customer (*e.g*. low/high profile), etc.

This lecture uses a simulated data set, generated in two steps, starting with a set of a few basic features and enlarging it with some feature engineering. In the first step, 1,744,532 transactions were generated for the period from April 30th to September 30th (22 complete weeks). The initial features are:

* `TRANSACTION_ID`, a unique identifier of the transaction.

* `TX_DATETIME`, date and time at which the transaction occurs, as 'yyyy-mm-dd hh:mm:ss'.

* `CUSTOMER_ID`, a unique customer identifier.

* `TERMINAL_ID`, a unique terminal identifier.

* `TX_AMOUNT`, the transaction amount, in euros.

* `TX_FRAUD`, a dummy feature (1/0) for the transaction to be fraudulent.

The data set contains 13,081 (0.88%) fraudulent transactions, with a realistic degree of class imbalance.

Additional features:

* `TX_DURING_WEEKEND`, a dummy for the transaction taking place during the weekend.

* `TX_DURING_NIGHT`, a dummy for the transaction taking place during the night.

* `CUSTOMER_ID_NB_TX_1DAY_WINDOW`, number of transactions by the customer in that day.

* `CUSTOMER_ID_AVG_AMOUNT_1DAY_WINDOW`, average spending amount by the customer in that day.

* `CUSTOMER_ID_NB_TX_7DAY_WINDOW`, number of transactions by the customer in the last 7 days.

* `CUSTOMER_ID_AVG_AMOUNT_7DAY_WINDOW`, average spending amount by the customer in the last 7 days.

* `CUSTOMER_ID_NB_TX_30DAY_WINDOW`, number of transactions by the customer in the last 30 days.

* `CUSTOMER_ID_AVG_AMOUNT_30DAY_WINDOW`, average spending amount by the customer in the last 30 days.

* `TERMINAL_ID_NB_TX_1DAY_WINDOW`, number of transactions on the terminal in the last 8 days.

* `TERMINAL_ID_RISK_1DAY_WINDOW`, average number of frauds on the terminal in the last 8 days.

* `TERMINAL_ID_NB_TX_7DAY_WINDOW`, number of transactions on the terminal in the last 14 days.

* `TERMINAL_ID_RISK_7DAY_WINDOW`, average number of frauds on the terminal in the last 14 days.

* `TERMINAL_ID_NB_TX_30DAY_WINDOW`, number of transactions on the terminal in the last 30 days.

* `TERMINAL_ID_RISK_30DAY_WINDOW`, average number of frauds on the terminal in the last 30 days.

Source: YA Le Borgne, W Siblini, B Lebichot & G Bontempi (2022), *Reproducible Machine Learning for Credit Card Fraud Detection - Practical Handbook*, Université Libre de Bruxelles. April data have discarded, to get a set of complete weeks covering five months. 

## Questions

Q1. 
